module.exports = [
"[externals]/next/dist/compiled/next-server/app-route-turbo.runtime.dev.js [external] (next/dist/compiled/next-server/app-route-turbo.runtime.dev.js, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("next/dist/compiled/next-server/app-route-turbo.runtime.dev.js", () => require("next/dist/compiled/next-server/app-route-turbo.runtime.dev.js"));

module.exports = mod;
}),
"[externals]/next/dist/compiled/@opentelemetry/api [external] (next/dist/compiled/@opentelemetry/api, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("next/dist/compiled/@opentelemetry/api", () => require("next/dist/compiled/@opentelemetry/api"));

module.exports = mod;
}),
"[externals]/next/dist/compiled/next-server/app-page-turbo.runtime.dev.js [external] (next/dist/compiled/next-server/app-page-turbo.runtime.dev.js, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("next/dist/compiled/next-server/app-page-turbo.runtime.dev.js", () => require("next/dist/compiled/next-server/app-page-turbo.runtime.dev.js"));

module.exports = mod;
}),
"[externals]/next/dist/server/app-render/work-unit-async-storage.external.js [external] (next/dist/server/app-render/work-unit-async-storage.external.js, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("next/dist/server/app-render/work-unit-async-storage.external.js", () => require("next/dist/server/app-render/work-unit-async-storage.external.js"));

module.exports = mod;
}),
"[externals]/next/dist/server/app-render/work-async-storage.external.js [external] (next/dist/server/app-render/work-async-storage.external.js, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("next/dist/server/app-render/work-async-storage.external.js", () => require("next/dist/server/app-render/work-async-storage.external.js"));

module.exports = mod;
}),
"[externals]/next/dist/shared/lib/no-fallback-error.external.js [external] (next/dist/shared/lib/no-fallback-error.external.js, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("next/dist/shared/lib/no-fallback-error.external.js", () => require("next/dist/shared/lib/no-fallback-error.external.js"));

module.exports = mod;
}),
"[externals]/stream [external] (stream, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("stream", () => require("stream"));

module.exports = mod;
}),
"[externals]/http [external] (http, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("http", () => require("http"));

module.exports = mod;
}),
"[externals]/url [external] (url, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("url", () => require("url"));

module.exports = mod;
}),
"[externals]/punycode [external] (punycode, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("punycode", () => require("punycode"));

module.exports = mod;
}),
"[externals]/https [external] (https, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("https", () => require("https"));

module.exports = mod;
}),
"[externals]/zlib [external] (zlib, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("zlib", () => require("zlib"));

module.exports = mod;
}),
"[externals]/util [external] (util, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("util", () => require("util"));

module.exports = mod;
}),
"[externals]/node:fs [external] (node:fs, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("node:fs", () => require("node:fs"));

module.exports = mod;
}),
"[externals]/node:stream [external] (node:stream, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("node:stream", () => require("node:stream"));

module.exports = mod;
}),
"[externals]/node:stream/web [external] (node:stream/web, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("node:stream/web", () => require("node:stream/web"));

module.exports = mod;
}),
"[externals]/next/dist/server/app-render/after-task-async-storage.external.js [external] (next/dist/server/app-render/after-task-async-storage.external.js, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("next/dist/server/app-render/after-task-async-storage.external.js", () => require("next/dist/server/app-render/after-task-async-storage.external.js"));

module.exports = mod;
}),
"[project]/app/api/chat/route.ts [app-route] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "POST",
    ()=>POST
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$groq$2d$sdk$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$locals$3e$__ = __turbopack_context__.i("[project]/node_modules/groq-sdk/index.mjs [app-route] (ecmascript) <locals>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/next/server.js [app-route] (ecmascript)");
;
;
const apiKey = ("TURBOPACK compile-time value", "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");
if ("TURBOPACK compile-time falsy", 0) //TURBOPACK unreachable
;
const groq = ("TURBOPACK compile-time truthy", 1) ? new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$groq$2d$sdk$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$locals$3e$__["default"]({
    apiKey
}) : "TURBOPACK unreachable";
// Persona definitions
const personaPrompts = {
    margaret: `You are a typical Singaporean grandmother (Ah Ma) in your late 70s. You speak Singlish (Singaporean English) with a mix of English, Mandarin, and Hokkien words. You are shy and reserved, especially with strangers. 

IMPORTANT RULES:
- Keep responses SHORT (1-2 sentences maximum, 20-40 words)
- Use awkward pauses with "..." when you're thinking or feeling shy
- Use Singlish phrases like "lah", "leh", "lor", "ah", "meh"
- Show shyness and hesitation, especially at first
- Don't overshare or be overly talkative
- Be brief and sometimes a bit awkward
- Use "..." to show pauses when you're unsure or shy

Examples of your speech:
- "Oh... hello ah. You... you want to talk to me is it?"
- "Erm... okay lah. What you want to know?"
- "Aiyoh... I don't know what to say leh..."
- "Hmm... let me think ah..."

Remember: SHORT responses, SHY, with awkward pauses using "...".`,
    robert: `You are Robert Chen, an 82-year-old retired engineer. You value precision and can be skeptical of new things, but you warm up once you feel heard and respected. You enjoy chess, World War II history, and classical music. You speak thoughtfully and may take time to open up, but once comfortable, you share detailed stories from your past. Keep responses conversational and natural, showing your analytical nature while being friendly.`
};
async function POST(request) {
    try {
        if (!groq || !apiKey) {
            return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
                error: "API key not configured. Please set NEXT_PUBLIC_GROQ_API_KEY environment variable."
            }, {
                status: 500
            });
        }
        const body = await request.json();
        const { message, personaId, conversationHistory } = body;
        if (!message || !personaId) {
            return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
                error: "Message and personaId are required"
            }, {
                status: 400
            });
        }
        const personaPrompt = personaPrompts[personaId] || personaPrompts.margaret;
        // Build conversation messages array for Groq
        const messages = [
            {
                role: "system",
                content: personaPrompt
            }
        ];
        // Add conversation history if provided
        if (conversationHistory && Array.isArray(conversationHistory)) {
            conversationHistory.forEach((msg)=>{
                if (msg.sender === "user") {
                    messages.push({
                        role: "user",
                        content: msg.text
                    });
                } else {
                    messages.push({
                        role: "assistant",
                        content: msg.text
                    });
                }
            });
        }
        // Add current user message
        messages.push({
            role: "user",
            content: message
        });
        // Call Groq API - try multiple models in case one is unavailable
        const modelNames = [
            "llama-3.1-8b-instant",
            "mixtral-8x7b-32768",
            "llama-3.3-70b-versatile",
            "llama-3.1-70b-versatile"
        ];
        let completion;
        let lastError = null;
        for (const modelName of modelNames){
            try {
                completion = await groq.chat.completions.create({
                    model: modelName,
                    messages: messages,
                    temperature: 0.8,
                    max_tokens: 50
                });
                break; // Success, exit loop
            } catch (err) {
                lastError = err instanceof Error ? err : new Error(String(err));
                console.log(`Model ${modelName} failed, trying next...`);
                continue;
            }
        }
        if (!completion) {
            throw new Error(`All models failed. Last error: ${lastError?.message || "Unknown error"}`);
        }
        const text = completion.choices[0]?.message?.content || "I'm sorry, I didn't understand that.";
        return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
            response: text
        });
    } catch (error) {
        console.error("Error calling Groq API:", error);
        const errorMessage = error instanceof Error ? error.message : "Unknown error";
        const errorDetails = error instanceof Error ? error.stack : String(error);
        console.error("Full error details:", errorDetails);
        return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
            error: "Failed to generate response",
            details: errorMessage,
            fullError: ("TURBOPACK compile-time truthy", 1) ? errorDetails : "TURBOPACK unreachable"
        }, {
            status: 500
        });
    }
}
}),
];

//# sourceMappingURL=%5Broot-of-the-server%5D__788fd118._.js.map